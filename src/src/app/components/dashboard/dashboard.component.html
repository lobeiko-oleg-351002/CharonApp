<div class="dashboard-container">
  <div class="dashboard-header">
    <h2>Metrics Dashboard</h2>
    <button class="refresh-btn" (click)="refresh()" [disabled]="loading">
      <span *ngIf="!loading">ðŸ”„ Refresh</span>
      <span *ngIf="loading">Loading...</span>
    </button>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <app-filter-panel
    [filter]="filter"
    (filterChange)="onFilterChange($event)">
  </app-filter-panel>

  <div class="dashboard-grid">
    <div class="dashboard-card latest-values-card">
      <h3>Latest Values</h3>
      <app-latest-values
        [metrics]="latestMetrics"
        [loading]="loading">
      </app-latest-values>
    </div>

    <div class="dashboard-card chart-card">
      <h3>Metrics Charts</h3>
      
      <!-- Location Selector -->
      <app-location-selector
        [metrics]="chartMetrics"
        [selectedLocation]="selectedLocation"
        (locationChange)="onLocationChange($event)">
      </app-location-selector>

      <!-- Adaptive Charts by Type -->
      <div class="charts-container">
        <div *ngFor="let type of getMetricTypes()" class="chart-by-type">
          <h4 class="chart-type-title">{{ type.toUpperCase() }}</h4>
          <app-adaptive-chart
            [metrics]="getMetricsForType(type)"
            [loading]="loading"
            [dateRange]="chartDateRange"
            [location]="selectedLocation"
            [metricType]="type">
          </app-adaptive-chart>
        </div>
        
        <div *ngIf="getMetricTypes().length === 0 && !loading" class="no-charts">
          No metrics available for charts
        </div>
      </div>
    </div>

    <div class="dashboard-card aggregations-card">
      <h3>Aggregations</h3>
      <app-aggregations
        [aggregation]="aggregation"
        [loading]="loading">
      </app-aggregations>
    </div>
  </div>

  <app-daily-averages-table
    *ngIf="chartDateRange.fromDate && chartDateRange.toDate"
    [dailyAverages]="dailyAverages"
    [loading]="loading">
  </app-daily-averages-table>
</div>

